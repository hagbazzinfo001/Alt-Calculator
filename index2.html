<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calculator App</title>
    <style>
      :root {
        --bg-color: #f4f4f4;
        --text-color: #000;
        --display-bg: #fff;
        --button-bg: #ddd;
        --button-hover: #ccc;
        --operator-bg: #fe9505;
        --equals-bg: #0a84ff;
        --clear-bg: #e74c3c;
      }

      .dark-theme {
        --bg-color: #121212;
        --text-color: #fff;
        --display-bg: #000;
        --button-bg: #333;
        --button-hover: #444;
      }

      body {
        background: var(--bg-color);
        font-family: "Segoe UI", sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        color: var(--text-color);
      }

      .calculator {
        background: var(--button-bg);
        padding: 20px;
        border-radius: 16px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
        width: 300px;
        max-width: 90vw;
      }

      .theme-toggle {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
      }

      .theme-toggle button {
        background: var(--button-bg);
        color: var(--text-color);
        border: none;
        padding: 5px 10px;
        border-radius: 6px;
        cursor: pointer;
      }

      .display {
        background: var(--display-bg);
        padding: 20px;
        font-size: 2rem;
        border-radius: 8px;
        text-align: right;
        min-height: 50px;
        overflow-x: auto;
      }

      .history {
        font-size: 0.9rem;
        color: var(--text-color);
        max-height: 100px;
        overflow-y: auto;
        margin-top: 10px;
      }

      .buttons {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        margin-top: 20px;
      }

      button {
        font-size: 1.2rem;
        padding: 15px;
        border: none;
        border-radius: 8px;
        background: var(--button-bg);
        color: var(--text-color);
        cursor: pointer;
        transition: 0.2s;
      }

      button:hover {
        background: var(--button-hover);
      }

      button.operator {
        background: var(--operator-bg);
        color: white;
      }

      button.equals {
        background: var(--equals-bg);
        color: white;
        grid-column: span 2;
      }

      button.clear {
        background: var(--clear-bg);
        color: white;
      }

      @media (max-width: 400px) {
        .display {
          font-size: 1.5rem;
        }
        button {
          padding: 10px;
          font-size: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="calculator">
      <div class="theme-toggle">
        <button onclick="toggleTheme()">Toggle Theme</button>
        <button onclick="clearHistory()">Clear History</button>
      </div>
      <div class="display" id="display">0</div>
      <div class="history" id="history"></div>
      <div class="buttons">
        <button class="clear" data-value="C">C</button>
        <button data-value="←">&#8592;</button>
        <button data-value="/">/</button>
        <button data-value="*">*</button>

        <button data-value="7">7</button>
        <button data-value="8">8</button>
        <button data-value="9">9</button>
        <button data-value="-">-</button>

        <button data-value="4">4</button>
        <button data-value="5">5</button>
        <button data-value="6">6</button>
        <button data-value="+">+</button>

        <button data-value="1">1</button>
        <button data-value="2">2</button>
        <button data-value="3">3</button>
        <button class="equals" data-value="=">=</button>

        <button data-value="0">0</button>
        <button data-value=".">.</button>
      </div>
    </div>

    <script>
      const display = document.getElementById("display");
      const history = document.getElementById("history");
      let currentInput = "";

      function updateDisplay() {
        display.textContent = currentInput || "0";
      }

      function appendNumber(num) {
        currentInput += num;
        updateDisplay();
      }

      function appendOperator(op) {
        if (currentInput === "") return;
        const lastChar = currentInput.slice(-1);
        if ("+-*/".includes(lastChar)) {
          currentInput = currentInput.slice(0, -1);
        }
        currentInput += op;
        updateDisplay();
      }

      function appendDot() {
        const parts = currentInput.split(/[-+*/]/);
        if (!parts[parts.length - 1].includes(".")) {
          currentInput += ".";
          updateDisplay();
        }
      }

      function clearDisplay() {
        currentInput = "";
        updateDisplay();
      }

      function backspace() {
        currentInput = currentInput.slice(0, -1);
        updateDisplay();
      }

      function calculateResult() {
        try {
          const result = eval(currentInput);
          const entry = `${currentInput} = ${result}`;
          const div = document.createElement("div");
          div.textContent = entry;
          history.appendChild(div);
          saveToHistory(entry);
          currentInput = result.toString();
          updateDisplay();
        } catch {
          display.textContent = "Error";
        }
      }

      function saveToHistory(entry) {
        let logs = JSON.parse(localStorage.getItem("calc-history")) || [];
        logs.push(entry);
        localStorage.setItem("calc-history", JSON.stringify(logs));
      }

      function loadHistory() {
        let logs = JSON.parse(localStorage.getItem("calc-history")) || [];
        history.innerHTML = logs.map((item) => `<div>${item}</div>`).join("");
      }

      window.clearHistory = function () {
        localStorage.removeItem("calc-history");
        history.innerHTML = "";
      };

      window.toggleTheme = function () {
        document.body.classList.toggle("dark-theme");
      };

      // Centralized button handler
      document.querySelectorAll(".buttons button").forEach((btn) => {
        btn.addEventListener("click", () => {
          const value = btn.dataset.value;
          if (!value) return;

          switch (value) {
            case "=":
              return calculateResult();
            case "C":
              return clearDisplay();
            case "←":
              return backspace();
            case "+":
            case "-":
            case "*":
            case "/":
              return appendOperator(value);
            case ".":
              return appendDot();
            default:
              if (!isNaN(value)) appendNumber(value);
          }
        });
      });

      // Keyboard support
      document.addEventListener("keydown", (e) => {
        if (!isNaN(e.key)) appendNumber(e.key);
        else if ("+-*/".includes(e.key)) appendOperator(e.key);
        else if (e.key === ".") appendDot();
        else if (e.key === "Enter") calculateResult();
        else if (e.key === "Backspace") backspace();
        else if (e.key === "Escape") clearDisplay();
      });

      updateDisplay();
      loadHistory();
    </script>
  </body>
</html>
